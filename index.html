<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mermaid Editor — Mermaid 图表转图片工具</title>
  <meta name="description" content="在线 Mermaid 代码转图片工具，支持流程图、时序图、甘特图等，实时预览并一键导出 SVG/PNG。Online Mermaid diagram to image converter with live preview and SVG/PNG export.">
  <meta name="keywords" content="mermaid, mermaid转图片, mermaid to image, 流程图转图片, diagram to image, flowchart export, SVG export, PNG export, mermaid editor">
  <meta name="author" content="Mermaid Editor">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://caoergou.github.io/mermaid-pic/">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Mermaid Editor — Mermaid 图表转图片工具">
  <meta property="og:description" content="在线 Mermaid 代码转图片工具，实时预览，一键导出 SVG/PNG。Online Mermaid diagram to image converter.">
  <meta property="og:url" content="https://caoergou.github.io/mermaid-pic/">

  <!-- Favicon: Mermaid-style graph icon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%23333'/><circle cx='16' cy='7' r='3' fill='%2300b4d8'/><circle cx='7' cy='25' r='3' fill='%2300b4d8'/><circle cx='25' cy='25' r='3' fill='%2300b4d8'/><line x1='16' y1='10' x2='7' y2='22' stroke='%2300b4d8' stroke-width='2'/><line x1='16' y1='10' x2='25' y2='22' stroke='%2300b4d8' stroke-width='2'/></svg>">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=LXGW+WenKai+TC&display=swap">
  <style>
    @font-face {
      font-family: 'Virgil';
      src: url('https://cdn.jsdelivr.net/gh/excalidraw/virgil/Virgil.woff2') format('woff2');
      font-display: swap;
    }
  </style>
  <link rel="stylesheet" href="style.css">
  <script type="importmap">
  {
    "imports": {
      "codemirror": "https://esm.sh/codemirror@6.0.1/es2022/codemirror.mjs",
      "@codemirror/state": "https://esm.sh/@codemirror/state@6",
      "@codemirror/view": "https://esm.sh/@codemirror/view@6",
      "@codemirror/language": "https://esm.sh/@codemirror/language@6",
      "@codemirror/autocomplete": "https://esm.sh/@codemirror/autocomplete@6",
      "@codemirror/commands": "https://esm.sh/@codemirror/commands@6",
      "@codemirror/lint": "https://esm.sh/@codemirror/lint@6",
      "@codemirror/search": "https://esm.sh/@codemirror/search@6",
      "@codemirror/theme-one-dark": "https://esm.sh/@codemirror/theme-one-dark@6",
      "@lezer/common": "https://esm.sh/@lezer/common@1",
      "@lezer/highlight": "https://esm.sh/@lezer/highlight@1",
      "@lezer/lr": "https://esm.sh/@lezer/lr@1",
      "codemirror-lang-mermaid": "https://esm.sh/codemirror-lang-mermaid@0.5.0"
    }
  }
  </script>
</head>
<body>
  <header class="toolbar">
    <h1 class="toolbar__title">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="5" r="3"/><circle cx="5" cy="19" r="3"/><circle cx="19" cy="19" r="3"/><line x1="12" y1="8" x2="5" y2="16"/><line x1="12" y1="8" x2="19" y2="16"/></svg>
      Mermaid Editor
    </h1>

    <select id="theme-select" style="display:none">
      <option value="default">Default</option>
      <option value="dark">Dark</option>
      <option value="forest">Forest</option>
      <option value="neutral">Neutral</option>
      <option value="base">Base</option>
    </select>

    <!-- VS Code–style menu bar -->
    <nav class="menubar" id="menubar">
      <div class="menubar__item" data-menu="file">
        <button class="menubar__trigger">文件</button>
        <div class="menubar__dropdown">
          <button id="btn-download-png" data-menu-action><span>下载 PNG</span><kbd>⌘⇧S</kbd></button>
          <button id="btn-download-svg" data-menu-action><span>下载 SVG</span><kbd>⌘S</kbd></button>
          <button id="btn-copy-png" data-menu-action><span>复制 PNG</span><kbd>⌘⇧C</kbd></button>
          <div class="menubar__sep"></div>
          <button id="btn-share" data-menu-action><span>分享链接</span></button>
          <button id="btn-embed-code" data-menu-action><span>嵌入代码</span></button>
          <button id="btn-copy-ai-prompt" data-menu-action><span>AI 提示词</span></button>
          <div class="menubar__sep"></div>
          <div class="menubar__label">导出背景</div>
          <button data-menu-action data-bg-pick="white" class="has-check active"><span>白色</span></button>
          <button data-menu-action data-bg-pick="transparent" class="has-check"><span>透明</span></button>
          <button data-menu-action data-bg-pick="black" class="has-check"><span>黑色</span></button>
          <button data-menu-action data-bg-pick="custom" class="has-check"><span>自定义颜色</span><input type="color" id="export-bg-custom" value="#ffffff" class="menubar__color-input"></button>
        </div>
      </div>

      <div class="menubar__item" data-menu="edit">
        <button class="menubar__trigger">编辑</button>
        <div class="menubar__dropdown">
          <button id="hand-drawn-btn" data-menu-action class="has-check active"><span>手绘风格</span></button>
        </div>
      </div>

      <div class="menubar__item" data-menu="view">
        <button class="menubar__trigger">视图</button>
        <div class="menubar__dropdown">
          <div class="menubar__label">图表主题</div>
          <button data-menu-action data-theme-pick="default" class="has-check active"><span>Default</span></button>
          <button data-menu-action data-theme-pick="dark" class="has-check"><span>Dark</span></button>
          <button data-menu-action data-theme-pick="forest" class="has-check"><span>Forest</span></button>
          <button data-menu-action data-theme-pick="neutral" class="has-check"><span>Neutral</span></button>
          <button data-menu-action data-theme-pick="base" class="has-check"><span>Base</span></button>
          <div class="menubar__sep"></div>
          <button id="ui-theme-toggle" data-menu-action>
            <span>
              <svg id="icon-sun" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
              <svg id="icon-moon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
              深色/浅色模式
            </span>
          </button>
          <button id="menu-zoom-reset" data-menu-action><span>重置缩放</span></button>
          <button id="btn-bg-toggle" data-menu-action class="has-check"><span>棋盘格背景</span></button>
        </div>
      </div>

      <div class="menubar__item" data-menu="help">
        <button class="menubar__trigger">帮助</button>
        <div class="menubar__dropdown">
          <button id="btn-help" data-menu-action><span>示例与快捷键</span></button>
          <button id="btn-cmd-palette" data-menu-action><span>命令面板</span><kbd>⌘K</kbd></button>
          <div class="menubar__sep"></div>
          <button id="menu-github" data-menu-action><span>GitHub</span></button>
          <button id="btn-restart-tour-menu" data-menu-action><span>重新引导</span></button>
        </div>
      </div>
    </nav>

    <div class="toolbar__spacer"></div>

    <button id="btn-cmd-palette-quick" class="btn-cmdk" title="命令面板 (Ctrl+K)">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <span class="btn-cmdk__text">命令面板</span>
      <kbd>⌘K</kbd>
    </button>

    <button id="btn-mobile-more" class="toolbar-btn toolbar__mobile-more" title="更多选项" style="display:none">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="5" r="1" fill="currentColor"/><circle cx="12" cy="12" r="1" fill="currentColor"/><circle cx="12" cy="19" r="1" fill="currentColor"/></svg>
    </button>
  </header>

  <main class="editor-layout">
    <!-- Mobile tab bar -->
    <div class="mobile-tabs" id="mobile-tabs">
      <button class="mobile-tab active" id="tab-editor" data-i18n="editor">编辑器</button>
      <button class="mobile-tab" id="tab-preview" data-i18n="preview">预览</button>
    </div>
    <div class="panel panel--editor">
      <div class="panel__tab-bar">
        <div class="panel__tab panel__tab--active">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
          <span>mermaid</span>
        </div>
        <div class="panel__tab-spacer"></div>
        <span id="editor-status" class="panel__status"></span>
      </div>
      <div id="editor-container"></div>
    </div>
    <div id="divider" title="拖拽调整面板大小 · Drag to resize"></div>
    <div class="panel panel--preview">
      <div class="panel__tab-bar">
        <div class="panel__tab panel__tab--active">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
          <span>Preview</span>
        </div>
        <div class="panel__tab-spacer"></div>
        <div class="theme-pills" id="theme-pills" role="radiogroup" aria-label="Mermaid 主题">
          <button class="theme-pill active" data-theme="default" role="radio" aria-checked="true">Default</button>
          <button class="theme-pill" data-theme="dark" role="radio" aria-checked="false">Dark</button>
          <button class="theme-pill" data-theme="forest" role="radio" aria-checked="false">Forest</button>
          <button class="theme-pill" data-theme="neutral" role="radio" aria-checked="false">Neutral</button>
          <button class="theme-pill" data-theme="base" role="radio" aria-checked="false">Base</button>
        </div>
        <div class="tab-bar__sep"></div>
        <div class="bg-pills" id="bg-pills" role="radiogroup" aria-label="导出背景">
          <button class="bg-pill active" data-bg="white" role="radio" aria-checked="true" title="白色背景">
            <span class="bg-pill__swatch bg-pill__swatch--white"></span>
          </button>
          <button class="bg-pill" data-bg="transparent" role="radio" aria-checked="false" title="透明背景">
            <span class="bg-pill__swatch bg-pill__swatch--transparent"></span>
          </button>
          <button class="bg-pill" data-bg="black" role="radio" aria-checked="false" title="黑色背景">
            <span class="bg-pill__swatch bg-pill__swatch--black"></span>
          </button>
        </div>
        <span id="render-status" class="render-status"></span>
      </div>
      <div id="preview-viewport" class="preview-viewport">
        <div id="mermaid-preview" class="preview-container"></div>
        <div class="floating-zoom" id="floating-zoom">
          <button id="btn-zoom-out" class="btn-tiny" title="缩小">
            <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"/></svg>
          </button>
          <span id="zoom-label" class="zoom-label">100%</span>
          <button id="btn-zoom-in" class="btn-tiny" title="放大">
            <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          </button>
          <button id="btn-zoom-reset" class="btn-tiny" title="重置缩放">
            <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
          </button>
          <div class="floating-zoom__sep"></div>
          <button id="btn-bg-toggle" class="btn-tiny" title="切换棋盘格背景">
            <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>
          </button>
        </div>
      </div>
    </div>
  </main>

  <div id="toast" class="toast"></div>

  <!-- Command Palette -->
  <div id="cmd-palette-overlay" class="cmd-palette-overlay">
    <div class="cmd-palette" id="cmd-palette">
      <div class="cmd-palette__input-wrap">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" class="cmd-palette__input" id="cmd-palette-input" placeholder="输入命令或搜索..." autocomplete="off" spellcheck="false">
      </div>
      <div class="cmd-palette__list" id="cmd-palette-list"></div>
      <div class="cmd-palette__footer">
        <span><kbd>↑↓</kbd> 导航</span>
        <span><kbd>Enter</kbd> 执行</span>
        <span><kbd>Esc</kbd> 关闭</span>
      </div>
    </div>
  </div>

  <!-- Mobile overflow menu -->
  <div id="mobile-overflow-menu" class="mobile-overflow-menu">
    <div class="mobile-overflow-menu__backdrop" id="mobile-overflow-backdrop"></div>
    <div class="mobile-overflow-menu__panel">
      <button class="mobile-overflow-menu__item" id="mob-btn-share">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
        分享链接
      </button>
      <div class="mobile-overflow-menu__sep"></div>
      <button class="mobile-overflow-menu__item" id="mob-btn-download-png">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        下载 PNG
      </button>
      <button class="mobile-overflow-menu__item" id="mob-btn-download-svg">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        下载 SVG
      </button>
      <div class="mobile-overflow-menu__sep"></div>
      <button class="mobile-overflow-menu__item" id="mob-btn-help">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
        示例与快捷键
      </button>
    </div>
  </div>

  <!-- Interactive Tour -->
  <div id="tour-overlay" class="tour-overlay" style="display:none">
    <div id="tour-curtain-top"    class="tour-curtain"></div>
    <div id="tour-curtain-bottom" class="tour-curtain"></div>
    <div id="tour-curtain-left"   class="tour-curtain"></div>
    <div id="tour-curtain-right"  class="tour-curtain"></div>
    <div id="tour-highlight" class="tour-highlight"></div>
    <div id="tour-tooltip" class="tour-tooltip">
      <div id="tour-step" class="tour-tooltip__step"></div>
      <div id="tour-title" class="tour-tooltip__title"></div>
      <div id="tour-body" class="tour-tooltip__body"></div>
      <div class="tour-tooltip__footer">
        <div id="tour-dots" class="tour-dots"></div>
        <div style="display:flex;gap:6px">
          <button id="tour-skip" class="tour-btn">跳过 Skip</button>
          <button id="tour-next" class="tour-btn primary">下一步 Next →</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Example picker modal (triggered from help button) -->
  <div id="help-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal">
      <div class="modal__header">
        <h2 id="modal-title">示例模板 · Examples</h2>
        <button id="modal-close" class="btn-icon" title="关闭 Close">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
      </div>
      <div class="modal__body">
        <div class="help-section">
          <h3>选择一个示例开始 · Pick an example to start</h3>
          <div class="example-grid" id="modal-example-grid"></div>
        </div>
        <div class="help-section">
          <h3>快捷键 · Shortcuts</h3>
          <table class="help-table">
            <tr><td>复制 PNG · Copy PNG</td><td><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>C</kbd></td></tr>
            <tr><td>下载 SVG · Download SVG</td><td><kbd>Ctrl</kbd>+<kbd>S</kbd></td></tr>
            <tr><td>下载 PNG · Download PNG</td><td><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>S</kbd></td></tr>
            <tr><td>命令面板 · Command Palette</td><td><kbd>Ctrl</kbd>+<kbd>K</kbd></td></tr>
          </table>
        </div>
      </div>
      <div class="modal__footer">
        <button id="btn-restart-tour" class="tour-btn" style="background:var(--btn-bg);color:var(--btn-text);border-color:var(--border-color)">
          重新引导 · Restart Tour
        </button>
        <button id="modal-ok" class="btn-primary">关闭 Close</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
  <script type="module" src="app.js"></script>
</body>
</html>
